<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>libdsm: include/bdsm/smb_session.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libdsm
   &#160;<span id="projectnumber">0.0.0</span>
   </div>
   <div id="projectbrief">Minimalist and read-only SMB client lib</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_e1634d9b3ca600f7f85c6e273a88c21d.html">bdsm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">smb_session.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions to connect and authenticate to an SMB server.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;bdsm/netbios_session.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="smb__defs_8h.html">bdsm/smb_defs.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="smb__types_8h.html">bdsm/smb_types.h</a>&quot;</code><br/>
<code>#include &quot;bdsm/smb_message.h&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0bfe41e899e0cce788112d6b8d21f622"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsmb__session__t.html">smb_session_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smb__session_8h.html#a0bfe41e899e0cce788112d6b8d21f622">smb_session_new</a> ()</td></tr>
<tr class="memdesc:a0bfe41e899e0cce788112d6b8d21f622"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a new Session object.  <a href="#a0bfe41e899e0cce788112d6b8d21f622">More...</a><br/></td></tr>
<tr class="separator:a0bfe41e899e0cce788112d6b8d21f622"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb468640825f5358104efb80fa84a905"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smb__session_8h.html#abb468640825f5358104efb80fa84a905">smb_session_destroy</a> (<a class="el" href="structsmb__session__t.html">smb_session_t</a> *s)</td></tr>
<tr class="memdesc:abb468640825f5358104efb80fa84a905"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close a session and deallocate its ressources.  <a href="#abb468640825f5358104efb80fa84a905">More...</a><br/></td></tr>
<tr class="separator:abb468640825f5358104efb80fa84a905"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abded17c7bef9895052c8141fbc2f3655"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smb__session_8h.html#abded17c7bef9895052c8141fbc2f3655">smb_session_state</a> (<a class="el" href="structsmb__session__t.html">smb_session_t</a> *s)</td></tr>
<tr class="memdesc:abded17c7bef9895052c8141fbc2f3655"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the current state of the session.  <a href="#abded17c7bef9895052c8141fbc2f3655">More...</a><br/></td></tr>
<tr class="separator:abded17c7bef9895052c8141fbc2f3655"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa188972e5a14685572ea7fb9f4e0434"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smb__session_8h.html#afa188972e5a14685572ea7fb9f4e0434">smb_session_connect</a> (<a class="el" href="structsmb__session__t.html">smb_session_t</a> *s, const char *name, uint32_t ip)</td></tr>
<tr class="memdesc:afa188972e5a14685572ea7fb9f4e0434"><td class="mdescLeft">&#160;</td><td class="mdescRight">Establish a connection and negotiate a session protocol with a remote host.  <a href="#afa188972e5a14685572ea7fb9f4e0434">More...</a><br/></td></tr>
<tr class="separator:afa188972e5a14685572ea7fb9f4e0434"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d8bf61602125fdae02628f16e1fb5c5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smb__session_8h.html#a1d8bf61602125fdae02628f16e1fb5c5">smb_session_login</a> (<a class="el" href="structsmb__session__t.html">smb_session_t</a> *s, const char *domain, const char *user, const char *password)</td></tr>
<tr class="memdesc:a1d8bf61602125fdae02628f16e1fb5c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Authenticate on the remote host with the provided credentials.  <a href="#a1d8bf61602125fdae02628f16e1fb5c5">More...</a><br/></td></tr>
<tr class="separator:a1d8bf61602125fdae02628f16e1fb5c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9076f311152a1bf999123a1cd6a5652"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smb__session_8h.html#ae9076f311152a1bf999123a1cd6a5652">smb_session_is_guest</a> (<a class="el" href="structsmb__session__t.html">smb_session_t</a> *s)</td></tr>
<tr class="memdesc:ae9076f311152a1bf999123a1cd6a5652"><td class="mdescLeft">&#160;</td><td class="mdescRight">Am i logged in as Guest ?  <a href="#ae9076f311152a1bf999123a1cd6a5652">More...</a><br/></td></tr>
<tr class="separator:ae9076f311152a1bf999123a1cd6a5652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acff8dc7a4c4ef06b84baace09b6c05c4"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smb__session_8h.html#acff8dc7a4c4ef06b84baace09b6c05c4">smb_session_server_name</a> (<a class="el" href="structsmb__session__t.html">smb_session_t</a> *s)</td></tr>
<tr class="memdesc:acff8dc7a4c4ef06b84baace09b6c05c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the server name with the &lt;XX&gt; type.  <a href="#acff8dc7a4c4ef06b84baace09b6c05c4">More...</a><br/></td></tr>
<tr class="separator:acff8dc7a4c4ef06b84baace09b6c05c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions to connect and authenticate to an SMB server. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="afa188972e5a14685572ea7fb9f4e0434"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int smb_session_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmb__session__t.html">smb_session_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Establish a connection and negotiate a session protocol with a remote host. </p>
<p>You have to provide both the ip and the name. This is a constraint of Netbios, which requires you to know its name before he accepts to speak with you.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>A session object. </td></tr>
    <tr><td class="paramname">name</td><td>The ASCII netbios name, the name type will be coerced to &lt;20&gt; </td></tr>
    <tr><td class="paramname">ip</td><td>The ip of the machine to connect to (in network byte order) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 in case of error, a value &gt; 0 otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="abb468640825f5358104efb80fa84a905"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void smb_session_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmb__session__t.html">smb_session_t</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close a session and deallocate its ressources. </p>
<p>After destroying a session, all the <a class="el" href="structsmb__tid.html" title="The id of a connection to a share within a session. ">smb_tid</a>, <a class="el" href="structsmb__fid.html" title="The id of a file within a share within a session. ">smb_fid</a> and <a class="el" href="structsmb__fd.html" title="SMB File descriptor, represents a file within a session. ">smb_fd</a> associated with this session becomes invalid.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The session to destroy </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae9076f311152a1bf999123a1cd6a5652"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int smb_session_is_guest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmb__session__t.html">smb_session_t</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Am i logged in as Guest ? </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The session object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 -&gt; Logged in as guest 0 -&gt; Logged in as regular user -1 -&gt; Error (not logged in, invalid session, etc.) </dd></dl>

</div>
</div>
<a class="anchor" id="a1d8bf61602125fdae02628f16e1fb5c5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int smb_session_login </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmb__session__t.html">smb_session_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>domain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>password</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Authenticate on the remote host with the provided credentials. </p>
<p>Can be called if session state is SMB_STATE_DIALECT_OK. If successfull, session state transition to SMB_STATE_SESSION_OK </p>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>We currently only support LMv2 authentication.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The session object. </td></tr>
    <tr><td class="paramname">domain</td><td>The domain of the user. You should use the (netbios) uppercased machine name, then try 'WORKGROUP'. </td></tr>
    <tr><td class="paramname">user</td><td>The user name in the current locale </td></tr>
    <tr><td class="paramname">password</td><td>The password in the current locale </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 in case of failure, &gt; 0 in case of success. Success doesn't mean you are logged in with the user you requested. If guest are activated on the remote host, when login fails, you are logged in as 'Guest'. </dd></dl>

</div>
</div>
<a class="anchor" id="a0bfe41e899e0cce788112d6b8d21f622"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsmb__session__t.html">smb_session_t</a>* smb_session_new </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a new Session object. </p>
<p>To be able to perform actions on shares and file, you'll need to call smb_session_connect, then authenticate with smb_authenticate. </p>
<dl class="section return"><dt>Returns</dt><dd>A new Session object. </dd></dl>

</div>
</div>
<a class="anchor" id="acff8dc7a4c4ef06b84baace09b6c05c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* smb_session_server_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmb__session__t.html">smb_session_t</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the server name with the &lt;XX&gt; type. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The session object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The server name or NULL. The memory is owned by the session object. </dd></dl>

</div>
</div>
<a class="anchor" id="abded17c7bef9895052c8141fbc2f3655"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int smb_session_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmb__session__t.html">smb_session_t</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the current state of the session. </p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="smb__defs_8h.html#abb3cf125f0402bc1f2bf54b3995c1050" title="Error state, there was an error somewhere. ">SMB_STATE_ERROR</a> </dd>
<dd>
<a class="el" href="smb__defs_8h.html#a26f543a878430315e314c357b9d58852" title="The SMB session has just been created. ">SMB_STATE_NEW</a> </dd>
<dd>
<a class="el" href="smb__defs_8h.html#a036e4d6271ae21c2d7e1d33b33f50c66" title="Session Authentication was successfull, you can become nasty. ">SMB_STATE_SESSION_OK</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 25 2014 16:12:45 for libdsm by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
